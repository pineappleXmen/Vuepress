import{_ as e,V as p,W as o,$ as a,a0 as t,Y as n,D as c}from"./framework-3845b112.js";const i={},l=t(`<h2 id="aop" tabindex="-1"><a class="header-anchor" href="#aop" aria-hidden="true">#</a> AOP</h2><p>AOP åº•å±‚å®ç°æ–¹å¼ä¹‹ä¸€æ˜¯ä»£ç†ï¼Œç”±ä»£ç†ç»“åˆé€šçŸ¥å’Œç›®æ ‡ï¼Œæä¾›å¢å¼ºåŠŸèƒ½</p><p>é™¤æ­¤ä»¥å¤–ï¼Œaspectj æä¾›äº†ä¸¤ç§å¦å¤–çš„ AOP åº•å±‚å®ç°ï¼š</p><ul><li><p>ç¬¬ä¸€ç§æ˜¯é€šè¿‡ ajc ç¼–è¯‘å™¨åœ¨<strong>ç¼–è¯‘</strong> class ç±»æ–‡ä»¶æ—¶ï¼Œå°±æŠŠé€šçŸ¥çš„å¢å¼ºåŠŸèƒ½ï¼Œç»‡å…¥åˆ°ç›®æ ‡ç±»çš„å­—èŠ‚ç ä¸­</p></li><li><p>ç¬¬äºŒç§æ˜¯é€šè¿‡ agent åœ¨<strong>åŠ è½½</strong>ç›®æ ‡ç±»æ—¶ï¼Œä¿®æ”¹ç›®æ ‡ç±»çš„å­—èŠ‚ç ï¼Œç»‡å…¥å¢å¼ºåŠŸèƒ½</p></li><li><p>ä½œä¸ºå¯¹æ¯”ï¼Œä¹‹å‰å­¦ä¹ çš„ä»£ç†æ˜¯<strong>è¿è¡Œ</strong>æ—¶ç”Ÿæˆæ–°çš„å­—èŠ‚ç </p></li></ul><p>ç®€å•æ¯”è¾ƒçš„è¯ï¼š</p><ul><li>aspectj åœ¨ç¼–è¯‘å’ŒåŠ è½½æ—¶ï¼Œä¿®æ”¹ç›®æ ‡å­—èŠ‚ç ï¼Œæ€§èƒ½è¾ƒé«˜</li><li>aspectj å› ä¸ºä¸ç”¨ä»£ç†ï¼Œèƒ½çªç ´ä¸€äº›æŠ€æœ¯ä¸Šçš„é™åˆ¶ï¼Œä¾‹å¦‚å¯¹æ„é€ ã€å¯¹é™æ€æ–¹æ³•ã€å¯¹ final ä¹Ÿèƒ½å¢å¼º</li><li>ä½† aspectj ä¾µå…¥æ€§è¾ƒå¼ºï¼Œä¸”éœ€è¦å­¦ä¹ æ–°çš„ aspectj ç‰¹æœ‰è¯­æ³•ï¼Œå› æ­¤æ²¡æœ‰å¹¿æ³›æµè¡Œ</li></ul><h3 id="_9-aop-å®ç°ä¹‹-ajc-ç¼–è¯‘å™¨" tabindex="-1"><a class="header-anchor" href="#_9-aop-å®ç°ä¹‹-ajc-ç¼–è¯‘å™¨" aria-hidden="true">#</a> 9) AOP å®ç°ä¹‹ ajc ç¼–è¯‘å™¨</h3><h4 id="æ”¶è·ğŸ’¡" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><ol><li>ç¼–è¯‘å™¨ä¹Ÿèƒ½ä¿®æ”¹ class å®ç°å¢å¼º</li><li>ç¼–è¯‘å™¨å¢å¼ºèƒ½çªç ´ä»£ç†ä»…èƒ½é€šè¿‡æ–¹æ³•é‡å†™å¢å¼ºçš„é™åˆ¶ï¼šå¯ä»¥å¯¹æ„é€ æ–¹æ³•ã€é™æ€æ–¹æ³•ç­‰å®ç°å¢å¼º</li></ol><blockquote><p><em><strong>æ³¨æ„</strong></em></p><ul><li>ç‰ˆæœ¬é€‰æ‹©äº† java 8, å› ä¸ºç›®å‰çš„ aspectj-maven-plugin 1.14.0 æœ€é«˜åªæ”¯æŒåˆ° java 16</li><li>ä¸€å®šè¦ç”¨ maven çš„ compile æ¥ç¼–è¯‘, idea ä¸ä¼šè°ƒç”¨ ajc ç¼–è¯‘å™¨</li></ul></blockquote><h3 id="_10-aop-å®ç°ä¹‹-agent-ç±»åŠ è½½" tabindex="-1"><a class="header-anchor" href="#_10-aop-å®ç°ä¹‹-agent-ç±»åŠ è½½" aria-hidden="true">#</a> 10) AOP å®ç°ä¹‹ agent ç±»åŠ è½½</h3><h4 id="æ”¶è·ğŸ’¡-1" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-1" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><ol><li>ç±»åŠ è½½æ—¶å¯ä»¥é€šè¿‡ agent ä¿®æ”¹ class å®ç°å¢å¼º</li></ol><h3 id="_11-aop-å®ç°ä¹‹-proxy" tabindex="-1"><a class="header-anchor" href="#_11-aop-å®ç°ä¹‹-proxy" aria-hidden="true">#</a> 11) AOP å®ç°ä¹‹ proxy</h3><h4 id="æ¼”ç¤º1-jdk-åŠ¨æ€ä»£ç†" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º1-jdk-åŠ¨æ€ä»£ç†" aria-hidden="true">#</a> æ¼”ç¤º1 - jdk åŠ¨æ€ä»£ç†</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdkProxyDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">interface</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
        <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Target</span> <span class="token keyword">implements</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;target foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç›®æ ‡å¯¹è±¡</span>
        <span class="token class-name">Target</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Target</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä»£ç†å¯¹è±¡</span>
        <span class="token class-name">Foo</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Foo</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>
                <span class="token class-name">Target</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">Foo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>p<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;proxy before...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;proxy after...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è°ƒç”¨ä»£ç†</span>
        proxy<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>proxy before...
target foo
proxy after...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ”¶è·ğŸ’¡-2" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-2" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><ul><li>jdk åŠ¨æ€ä»£ç†è¦æ±‚ç›®æ ‡<strong>å¿…é¡»</strong>å®ç°æ¥å£ï¼Œç”Ÿæˆçš„ä»£ç†ç±»å®ç°ç›¸åŒæ¥å£ï¼Œå› æ­¤ä»£ç†ä¸ç›®æ ‡ä¹‹é—´æ˜¯å¹³çº§å…„å¼Ÿå…³ç³»</li></ul><h4 id="æ¼”ç¤º2-cglib-ä»£ç†" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º2-cglib-ä»£ç†" aria-hidden="true">#</a> æ¼”ç¤º2 - cglib ä»£ç†</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CglibProxyDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Target</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;target foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç›®æ ‡å¯¹è±¡</span>
        <span class="token class-name">Target</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Target</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä»£ç†å¯¹è±¡</span>
        <span class="token class-name">Target</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Target</span><span class="token punctuation">)</span> <span class="token class-name">Enhancer</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Target</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> 
                <span class="token punctuation">(</span><span class="token class-name">MethodInterceptor</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>p<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">,</span> methodProxy<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;proxy before...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Object</span> result <span class="token operator">=</span> methodProxy<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å¦ä¸€ç§è°ƒç”¨æ–¹æ³•ï¼Œä¸éœ€è¦ç›®æ ‡å¯¹è±¡å®ä¾‹</span>
<span class="token comment">//            Object result = methodProxy.invokeSuper(p, args);</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;proxy after...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è°ƒç”¨ä»£ç†</span>
        proxy<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœä¸ jdk åŠ¨æ€ä»£ç†ç›¸åŒ</p><h4 id="æ”¶è·ğŸ’¡-3" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-3" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><ul><li>cglib ä¸è¦æ±‚ç›®æ ‡å®ç°æ¥å£ï¼Œå®ƒç”Ÿæˆçš„ä»£ç†ç±»æ˜¯ç›®æ ‡çš„å­ç±»ï¼Œå› æ­¤ä»£ç†ä¸ç›®æ ‡ä¹‹é—´æ˜¯å­çˆ¶å…³ç³»</li><li>é™åˆ¶â›”ï¼šæ ¹æ®ä¸Šè¿°åˆ†æ final ç±»æ— æ³•è¢« cglib å¢å¼º</li></ul><h3 id="_12-jdk-åŠ¨æ€ä»£ç†è¿›é˜¶" tabindex="-1"><a class="header-anchor" href="#_12-jdk-åŠ¨æ€ä»£ç†è¿›é˜¶" aria-hidden="true">#</a> 12) jdk åŠ¨æ€ä»£ç†è¿›é˜¶</h3><h4 id="æ¼”ç¤º1-æ¨¡æ‹Ÿ-jdk-åŠ¨æ€ä»£ç†" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º1-æ¨¡æ‹Ÿ-jdk-åŠ¨æ€ä»£ç†" aria-hidden="true">#</a> æ¼”ç¤º1 - æ¨¡æ‹Ÿ jdk åŠ¨æ€ä»£ç†</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">A12</span> <span class="token punctuation">{</span>

    <span class="token keyword">interface</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
        <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Target</span> <span class="token keyword">implements</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;target foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;target bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// â¬‡ï¸1. åˆ›å»ºä»£ç†ï¼Œè¿™æ—¶ä¼ å…¥ InvocationHandler</span>
        <span class="token class-name">Foo</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> $<span class="token class-name">Proxy0</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token comment">// â¬‡ï¸5. è¿›å…¥ InvocationHandler</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span><span class="token punctuation">{</span>
                <span class="token comment">// â¬‡ï¸6. åŠŸèƒ½å¢å¼º</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;before...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// â¬‡ï¸7. åå°„è°ƒç”¨ç›®æ ‡æ–¹æ³•</span>
                <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Target</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// â¬‡ï¸2. è°ƒç”¨ä»£ç†æ–¹æ³•</span>
        proxy<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¨¡æ‹Ÿä»£ç†å®ç°</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">UndeclaredThrowableException</span></span><span class="token punctuation">;</span>

<span class="token comment">// â¬‡ï¸è¿™å°±æ˜¯ jdk ä»£ç†ç±»çš„æºç , ç§˜å¯†éƒ½åœ¨é‡Œé¢</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> $<span class="token class-name">Proxy0</span> <span class="token keyword">extends</span> <span class="token class-name">Proxy</span> <span class="token keyword">implements</span> <span class="token class-name">A12<span class="token punctuation">.</span>Foo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> $<span class="token class-name">Proxy0</span><span class="token punctuation">(</span><span class="token class-name">InvocationHandler</span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// â¬‡ï¸3. è¿›å…¥ä»£ç†æ–¹æ³•</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// â¬‡ï¸4. å›è°ƒ InvocationHandler</span>
            h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> foo<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token operator">|</span> <span class="token class-name">Error</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> result <span class="token operator">=</span> h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> bar<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token operator">|</span> <span class="token class-name">Error</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">Method</span> foo<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">Method</span> bar<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            foo <span class="token operator">=</span> <span class="token class-name">A12<span class="token punctuation">.</span>Foo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bar <span class="token operator">=</span> <span class="token class-name">A12<span class="token punctuation">.</span>Foo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchMethodError</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ”¶è·ğŸ’¡-4" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-4" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><p>ä»£ç†ä¸€ç‚¹éƒ½ä¸éš¾ï¼Œæ— éå°±æ˜¯åˆ©ç”¨äº†å¤šæ€ã€åå°„çš„çŸ¥è¯†</p><ol><li>æ–¹æ³•é‡å†™å¯ä»¥å¢å¼ºé€»è¾‘ï¼Œåªä¸è¿‡è¿™ã€å¢å¼ºé€»è¾‘ã€‘åƒå˜ä¸‡åŒ–ï¼Œä¸èƒ½å†™æ­»åœ¨ä»£ç†å†…éƒ¨</li><li>é€šè¿‡æ¥å£å›è°ƒå°†ã€å¢å¼ºé€»è¾‘ã€‘ç½®äºä»£ç†ç±»ä¹‹å¤–</li><li>é…åˆæ¥å£æ–¹æ³•åå°„ï¼ˆæ˜¯å¤šæ€è°ƒç”¨ï¼‰ï¼Œå°±å¯ä»¥å†è”åŠ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•</li><li>ä¼šç”¨ arthas çš„ jad å·¥å…·åç¼–è¯‘ä»£ç†ç±»</li><li>é™åˆ¶â›”ï¼šä»£ç†å¢å¼ºæ˜¯å€ŸåŠ©å¤šæ€æ¥å®ç°ï¼Œå› æ­¤æˆå‘˜å˜é‡ã€é™æ€æ–¹æ³•ã€final æ–¹æ³•å‡ä¸èƒ½é€šè¿‡ä»£ç†å®ç°</li></ol><h4 id="æ¼”ç¤º2-æ–¹æ³•åå°„ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º2-æ–¹æ³•åå°„ä¼˜åŒ–" aria-hidden="true">#</a> æ¼”ç¤º2 - æ–¹æ³•åå°„ä¼˜åŒ–</h4><h5 id="ä»£ç å‚è€ƒ" tabindex="-1"><a class="header-anchor" href="#ä»£ç å‚è€ƒ" aria-hidden="true">#</a> ä»£ç å‚è€ƒ</h5><p><strong>com.itheima.a12.TestMethodInvoke</strong></p><h4 id="æ”¶è·ğŸ’¡-5" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-5" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><ol><li>å‰ 16 æ¬¡åå°„æ€§èƒ½è¾ƒä½</li><li>ç¬¬ 17 æ¬¡è°ƒç”¨ä¼šç”Ÿæˆä»£ç†ç±»ï¼Œä¼˜åŒ–ä¸ºéåå°„è°ƒç”¨</li><li>ä¼šç”¨ arthas çš„ jad å·¥å…·åç¼–è¯‘ç¬¬ 17 æ¬¡è°ƒç”¨ç”Ÿæˆçš„ä»£ç†ç±»</li></ol><blockquote><p><em><strong>æ³¨æ„</strong></em></p><p>è¿è¡Œæ—¶è¯·æ·»åŠ  --add-opens java.base/java.lang.reflect=ALL-UNNAMED --add-opens java.base/jdk.internal.reflect=ALL-UNNAMED</p></blockquote><h3 id="_13-cglib-ä»£ç†è¿›é˜¶" tabindex="-1"><a class="header-anchor" href="#_13-cglib-ä»£ç†è¿›é˜¶" aria-hidden="true">#</a> 13) cglib ä»£ç†è¿›é˜¶</h3><h4 id="æ¼”ç¤º-æ¨¡æ‹Ÿ-cglib-ä»£ç†" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º-æ¨¡æ‹Ÿ-cglib-ä»£ç†" aria-hidden="true">#</a> æ¼”ç¤º - æ¨¡æ‹Ÿ cglib ä»£ç†</h4><h5 id="ä»£ç å‚è€ƒ-1" tabindex="-1"><a class="header-anchor" href="#ä»£ç å‚è€ƒ-1" aria-hidden="true">#</a> ä»£ç å‚è€ƒ</h5><p><strong>com.itheima.a13</strong> åŒ…</p><h4 id="æ”¶è·ğŸ’¡-6" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-6" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><p>å’Œ jdk åŠ¨æ€ä»£ç†åŸç†æŸ¥ä¸å¤š</p><ol><li>å›è°ƒçš„æ¥å£æ¢äº†ä¸€ä¸‹ï¼ŒInvocationHandler æ”¹æˆäº† MethodInterceptor</li><li>è°ƒç”¨ç›®æ ‡æ—¶æœ‰æ‰€æ”¹è¿›ï¼Œè§ä¸‹é¢ä»£ç ç‰‡æ®µ <ol><li>method.invoke æ˜¯åå°„è°ƒç”¨ï¼Œå¿…é¡»è°ƒç”¨åˆ°è¶³å¤Ÿæ¬¡æ•°æ‰ä¼šè¿›è¡Œä¼˜åŒ–</li><li>methodProxy.invoke æ˜¯ä¸åå°„è°ƒç”¨ï¼Œå®ƒä¼šæ­£å¸¸ï¼ˆé—´æ¥ï¼‰è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ï¼ˆSpring é‡‡ç”¨ï¼‰</li><li>methodProxy.invokeSuper ä¹Ÿæ˜¯ä¸åå°„è°ƒç”¨ï¼Œå®ƒä¼šæ­£å¸¸ï¼ˆé—´æ¥ï¼‰è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œå¯ä»¥çœç•¥ç›®æ ‡å¯¹è±¡</li></ol></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">A14Application</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InvocationTargetException</span> <span class="token punctuation">{</span>

        <span class="token class-name">Target</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Target</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Proxy</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        proxy<span class="token punctuation">.</span><span class="token function">setCallbacks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token class-name">MethodInterceptor</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>p<span class="token punctuation">,</span> m<span class="token punctuation">,</span> a<span class="token punctuation">,</span> mp<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;proxy before...&quot;</span> <span class="token operator">+</span> mp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// â¬‡ï¸è°ƒç”¨ç›®æ ‡æ–¹æ³•(ä¸‰ç§)</span>
<span class="token comment">//            Object result = m.invoke(target, a);  // â¬…ï¸åå°„è°ƒç”¨</span>
<span class="token comment">//            Object result = mp.invoke(target, a); // â¬…ï¸éåå°„è°ƒç”¨, ç»“åˆç›®æ ‡ç”¨</span>
            <span class="token class-name">Object</span> result <span class="token operator">=</span> mp<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// â¬…ï¸éåå°„è°ƒç”¨, ç»“åˆä»£ç†ç”¨</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;proxy after...&quot;</span> <span class="token operator">+</span> mp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// â¬‡ï¸è°ƒç”¨ä»£ç†æ–¹æ³•</span>
        proxy<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><em><strong>æ³¨æ„</strong></em></p><ul><li>è°ƒç”¨ Object çš„æ–¹æ³•, åä¸¤ç§åœ¨ jdk &gt;= 9 æ—¶éƒ½æœ‰é—®é¢˜, éœ€è¦ --add-opens java.base/java.lang=ALL-UNNAMED</li></ul></blockquote><h3 id="_14-cglib-é¿å…åå°„è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#_14-cglib-é¿å…åå°„è°ƒç”¨" aria-hidden="true">#</a> 14) cglib é¿å…åå°„è°ƒç”¨</h3><h4 id="æ¼”ç¤º-cglib-å¦‚ä½•é¿å…åå°„" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º-cglib-å¦‚ä½•é¿å…åå°„" aria-hidden="true">#</a> æ¼”ç¤º - cglib å¦‚ä½•é¿å…åå°„</h4><h5 id="ä»£ç å‚è€ƒ-2" tabindex="-1"><a class="header-anchor" href="#ä»£ç å‚è€ƒ-2" aria-hidden="true">#</a> ä»£ç å‚è€ƒ</h5><p><strong>com.itheima.a13.ProxyFastClass</strong>ï¼Œ<strong>com.itheima.a13.TargetFastClass</strong></p><h4 id="æ”¶è·ğŸ’¡-7" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-7" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><ol><li>å½“è°ƒç”¨ MethodProxy çš„ invoke æˆ– invokeSuper æ–¹æ³•æ—¶, ä¼šåŠ¨æ€ç”Ÿæˆä¸¤ä¸ªç±» <ul><li>ProxyFastClass é…åˆä»£ç†å¯¹è±¡ä¸€èµ·ä½¿ç”¨, é¿å…åå°„</li><li>TargetFastClass é…åˆç›®æ ‡å¯¹è±¡ä¸€èµ·ä½¿ç”¨, é¿å…åå°„ (Spring ç”¨çš„è¿™ç§)</li></ul></li><li>TargetFastClass è®°å½•äº† Target ä¸­æ–¹æ³•ä¸ç¼–å·çš„å¯¹åº”å…³ç³» <ul><li>save(long) ç¼–å· 2</li><li>save(int) ç¼–å· 1</li><li>save() ç¼–å· 0</li><li>é¦–å…ˆæ ¹æ®æ–¹æ³•åå’Œå‚æ•°ä¸ªæ•°ã€ç±»å‹, ç”¨ switch å’Œ if æ‰¾åˆ°è¿™äº›æ–¹æ³•ç¼–å·</li><li>ç„¶åå†æ ¹æ®ç¼–å·å»è°ƒç”¨ç›®æ ‡æ–¹æ³•, åˆç”¨äº†ä¸€å¤§å † switch å’Œ if, ä½†é¿å…äº†åå°„</li></ul></li><li>ProxyFastClass è®°å½•äº† Proxy ä¸­æ–¹æ³•ä¸ç¼–å·çš„å¯¹åº”å…³ç³»ï¼Œä¸è¿‡ Proxy é¢å¤–æä¾›äº†ä¸‹é¢å‡ ä¸ªæ–¹æ³• <ul><li>saveSuper(long) ç¼–å· 2ï¼Œä¸å¢å¼ºï¼Œä»…æ˜¯è°ƒç”¨ super.save(long)</li><li>saveSuper(int) ç¼–å· 1ï¼Œä¸å¢å¼º, ä»…æ˜¯è°ƒç”¨ super.save(int)</li><li>saveSuper() ç¼–å· 0ï¼Œä¸å¢å¼º, ä»…æ˜¯è°ƒç”¨ super.save()</li><li>æŸ¥æ‰¾æ–¹å¼ä¸ TargetFastClass ç±»ä¼¼</li></ul></li><li>ä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆéº»çƒ¦çš„ä¸€å¥—ä¸œè¥¿å‘¢ï¼Ÿ <ul><li>é¿å…åå°„, æé«˜æ€§èƒ½, ä»£ä»·æ˜¯ä¸€ä¸ªä»£ç†ç±»é…ä¸¤ä¸ª FastClass ç±», ä»£ç†ç±»ä¸­è¿˜å¾—å¢åŠ ä»…è°ƒç”¨ super çš„ä¸€å †æ–¹æ³•</li><li>ç”¨ç¼–å·å¤„ç†æ–¹æ³•å¯¹åº”å…³ç³»æ¯”è¾ƒçœå†…å­˜, å¦å¤–, æœ€åˆè·å¾—æ–¹æ³•é¡ºåºæ˜¯ä¸ç¡®å®šçš„, è¿™ä¸ªè¿‡ç¨‹æ²¡æ³•å›ºå®šæ­»</li></ul></li></ol><h3 id="_15-jdk-å’Œ-cglib-åœ¨-spring-ä¸­çš„ç»Ÿä¸€" tabindex="-1"><a class="header-anchor" href="#_15-jdk-å’Œ-cglib-åœ¨-spring-ä¸­çš„ç»Ÿä¸€" aria-hidden="true">#</a> 15) jdk å’Œ cglib åœ¨ Spring ä¸­çš„ç»Ÿä¸€</h3><p>Spring ä¸­å¯¹åˆ‡ç‚¹ã€é€šçŸ¥ã€åˆ‡é¢çš„æŠ½è±¡å¦‚ä¸‹</p><ul><li>åˆ‡ç‚¹ï¼šæ¥å£ Pointcutï¼Œå…¸å‹å®ç° AspectJExpressionPointcut</li><li>é€šçŸ¥ï¼šå…¸å‹æ¥å£ä¸º MethodInterceptor ä»£è¡¨ç¯ç»•é€šçŸ¥</li><li>åˆ‡é¢ï¼šAdvisorï¼ŒåŒ…å«ä¸€ä¸ª Advice é€šçŸ¥ï¼ŒPointcutAdvisor åŒ…å«ä¸€ä¸ª Advice é€šçŸ¥å’Œä¸€ä¸ª Pointcut</li></ul>`,57),u=n("p",null,"ä»£ç†ç›¸å…³ç±»å›¾",-1),r=n("ul",null,[n("li",null,"AopProxyFactory æ ¹æ® proxyTargetClass ç­‰è®¾ç½®é€‰æ‹© AopProxy å®ç°"),n("li",null,"AopProxy é€šè¿‡ getProxy åˆ›å»ºä»£ç†å¯¹è±¡"),n("li",null,"å›¾ä¸­ Proxy éƒ½å®ç°äº† Advised æ¥å£ï¼Œèƒ½å¤Ÿè·å¾—å…³è”çš„åˆ‡é¢é›†åˆä¸ç›®æ ‡ï¼ˆå…¶å®æ˜¯ä» ProxyFactory å–å¾—ï¼‰"),n("li",null,"è°ƒç”¨ä»£ç†æ–¹æ³•æ—¶ï¼Œä¼šå€ŸåŠ© ProxyFactory å°†é€šçŸ¥ç»Ÿä¸€è½¬ä¸ºç¯ç»•é€šçŸ¥ï¼šMethodInterceptor")],-1),d=t('<h4 id="æ¼”ç¤º-åº•å±‚åˆ‡ç‚¹ã€é€šçŸ¥ã€åˆ‡é¢" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º-åº•å±‚åˆ‡ç‚¹ã€é€šçŸ¥ã€åˆ‡é¢" aria-hidden="true">#</a> æ¼”ç¤º - åº•å±‚åˆ‡ç‚¹ã€é€šçŸ¥ã€åˆ‡é¢</h4><h4 id="æ”¶è·ğŸ’¡-8" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-8" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><ol><li>åº•å±‚çš„åˆ‡ç‚¹å®ç°</li><li>åº•å±‚çš„é€šçŸ¥å®ç°</li><li>åº•å±‚çš„åˆ‡é¢å®ç°</li><li>ProxyFactory ç”¨æ¥åˆ›å»ºä»£ç† <ul><li>å¦‚æœæŒ‡å®šäº†æ¥å£ï¼Œä¸” proxyTargetClass = falseï¼Œä½¿ç”¨ JdkDynamicAopProxy</li><li>å¦‚æœæ²¡æœ‰æŒ‡å®šæ¥å£ï¼Œæˆ–è€… proxyTargetClass = trueï¼Œä½¿ç”¨ ObjenesisCglibAopProxy <ul><li>ä¾‹å¤–ï¼šå¦‚æœç›®æ ‡æ˜¯æ¥å£ç±»å‹æˆ–å·²ç»æ˜¯ Jdk ä»£ç†ï¼Œä½¿ç”¨ JdkDynamicAopProxy</li></ul></li></ul></li></ol><blockquote><p><em><strong>æ³¨æ„</strong></em></p><ul><li>è¦åŒºåˆ†æœ¬ç« èŠ‚æåˆ°çš„ MethodInterceptorï¼Œå®ƒä¸ä¹‹å‰ cglib ä¸­ç”¨çš„çš„ MethodInterceptor æ˜¯ä¸åŒçš„æ¥å£</li></ul></blockquote><h3 id="_16-åˆ‡ç‚¹åŒ¹é…" tabindex="-1"><a class="header-anchor" href="#_16-åˆ‡ç‚¹åŒ¹é…" aria-hidden="true">#</a> 16) åˆ‡ç‚¹åŒ¹é…</h3><h4 id="æ¼”ç¤º-åˆ‡ç‚¹åŒ¹é…" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º-åˆ‡ç‚¹åŒ¹é…" aria-hidden="true">#</a> æ¼”ç¤º - åˆ‡ç‚¹åŒ¹é…</h4><h4 id="æ”¶è·ğŸ’¡-9" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-9" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><ol><li>å¸¸è§ aspectj åˆ‡ç‚¹ç”¨æ³•</li><li>aspectj åˆ‡ç‚¹çš„å±€é™æ€§ï¼Œå®é™…çš„ @Transactional åˆ‡ç‚¹å®ç°</li></ol><h3 id="_17-ä»-aspect-åˆ°-advisor" tabindex="-1"><a class="header-anchor" href="#_17-ä»-aspect-åˆ°-advisor" aria-hidden="true">#</a> 17) ä» @Aspect åˆ° Advisor</h3><h4 id="æ¼”ç¤º1-ä»£ç†åˆ›å»ºå™¨" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º1-ä»£ç†åˆ›å»ºå™¨" aria-hidden="true">#</a> æ¼”ç¤º1 - ä»£ç†åˆ›å»ºå™¨</h4><h5 id="ä»£ç å‚è€ƒ-3" tabindex="-1"><a class="header-anchor" href="#ä»£ç å‚è€ƒ-3" aria-hidden="true">#</a> ä»£ç å‚è€ƒ</h5><p><strong>org.springframework.aop.framework.autoproxy</strong> åŒ…</p><h4 id="æ”¶è·ğŸ’¡-10" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-10" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><ol><li>AnnotationAwareAspectJAutoProxyCreator çš„ä½œç”¨ <ul><li>å°†é«˜çº§ @Aspect åˆ‡é¢ç»Ÿä¸€ä¸ºä½çº§ Advisor åˆ‡é¢</li><li>åœ¨åˆé€‚çš„æ—¶æœºåˆ›å»ºä»£ç†</li></ul></li><li>findEligibleAdvisors æ‰¾åˆ°æœ‰ã€èµ„æ ¼ã€‘çš„ Advisors <ul><li>æœ‰ã€èµ„æ ¼ã€‘çš„ Advisor ä¸€éƒ¨åˆ†æ˜¯ä½çº§çš„, å¯ä»¥ç”±è‡ªå·±ç¼–å†™, å¦‚æœ¬ä¾‹ A17 ä¸­çš„ advisor3</li><li>æœ‰ã€èµ„æ ¼ã€‘çš„ Advisor å¦ä¸€éƒ¨åˆ†æ˜¯é«˜çº§çš„, ç”±è§£æ @Aspect åè·å¾—</li></ul></li><li>wrapIfNecessary <ul><li>å®ƒå†…éƒ¨è°ƒç”¨ findEligibleAdvisors, åªè¦è¿”å›é›†åˆä¸ç©º, åˆ™è¡¨ç¤ºéœ€è¦åˆ›å»ºä»£ç†</li><li>å®ƒçš„è°ƒç”¨æ—¶æœºé€šå¸¸åœ¨åŸå§‹å¯¹è±¡åˆå§‹åŒ–åæ‰§è¡Œ, ä½†ç¢°åˆ°å¾ªç¯ä¾èµ–ä¼šæå‰è‡³ä¾èµ–æ³¨å…¥ä¹‹å‰æ‰§è¡Œ</li></ul></li></ol><h4 id="æ¼”ç¤º2-ä»£ç†åˆ›å»ºæ—¶æœº" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º2-ä»£ç†åˆ›å»ºæ—¶æœº" aria-hidden="true">#</a> æ¼”ç¤º2 - ä»£ç†åˆ›å»ºæ—¶æœº</h4><h5 id="ä»£ç å‚è€ƒ-4" tabindex="-1"><a class="header-anchor" href="#ä»£ç å‚è€ƒ-4" aria-hidden="true">#</a> ä»£ç å‚è€ƒ</h5><p><strong>org.springframework.aop.framework.autoproxy.A17_1</strong></p><h4 id="æ”¶è·ğŸ’¡-11" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-11" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><ol><li>ä»£ç†çš„åˆ›å»ºæ—¶æœº <ul><li>åˆå§‹åŒ–ä¹‹å (æ— å¾ªç¯ä¾èµ–æ—¶)</li><li>å®ä¾‹åˆ›å»ºå, ä¾èµ–æ³¨å…¥å‰ (æœ‰å¾ªç¯ä¾èµ–æ—¶), å¹¶æš‚å­˜äºäºŒçº§ç¼“å­˜</li></ul></li><li>ä¾èµ–æ³¨å…¥ä¸åˆå§‹åŒ–ä¸åº”è¯¥è¢«å¢å¼º, ä»åº”è¢«æ–½åŠ äºåŸå§‹å¯¹è±¡</li></ol><h4 id="æ¼”ç¤º3-before-å¯¹åº”çš„ä½çº§é€šçŸ¥" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º3-before-å¯¹åº”çš„ä½çº§é€šçŸ¥" aria-hidden="true">#</a> æ¼”ç¤º3 - @Before å¯¹åº”çš„ä½çº§é€šçŸ¥</h4><h5 id="ä»£ç å‚è€ƒ-5" tabindex="-1"><a class="header-anchor" href="#ä»£ç å‚è€ƒ-5" aria-hidden="true">#</a> ä»£ç å‚è€ƒ</h5><p><strong>org.springframework.aop.framework.autoproxy.A17_2</strong></p><h4 id="æ”¶è·ğŸ’¡-12" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-12" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><ol><li>@Before å‰ç½®é€šçŸ¥ä¼šè¢«è½¬æ¢ä¸ºåŸå§‹çš„ AspectJMethodBeforeAdvice å½¢å¼, è¯¥å¯¹è±¡åŒ…å«äº†å¦‚ä¸‹ä¿¡æ¯ <ol><li>é€šçŸ¥ä»£ç ä»å“ªå„¿æ¥</li><li>åˆ‡ç‚¹æ˜¯ä»€ä¹ˆ(è¿™é‡Œä¸ºå•¥è¦åˆ‡ç‚¹, åé¢è§£é‡Š)</li><li>é€šçŸ¥å¯¹è±¡å¦‚ä½•åˆ›å»º, æœ¬ä¾‹å…±ç”¨åŒä¸€ä¸ª Aspect å¯¹è±¡</li></ol></li><li>ç±»ä¼¼çš„è¿˜æœ‰ <ol><li>AspectJAroundAdvice (ç¯ç»•é€šçŸ¥)</li><li>AspectJAfterReturningAdvice</li><li>AspectJAfterThrowingAdvice (ç¯ç»•é€šçŸ¥)</li><li>AspectJAfterAdvice (ç¯ç»•é€šçŸ¥)</li></ol></li></ol><h3 id="_18-é™æ€é€šçŸ¥è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#_18-é™æ€é€šçŸ¥è°ƒç”¨" aria-hidden="true">#</a> 18) é™æ€é€šçŸ¥è°ƒç”¨</h3><p>ä»£ç†å¯¹è±¡è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼ˆä»¥ JDK åŠ¨æ€ä»£ç†å®ç°ä¸ºä¾‹ï¼‰</p><ul><li>ä» ProxyFactory è·å¾— Target å’Œç¯ç»•é€šçŸ¥é“¾ï¼Œæ ¹æ®ä»–ä¿©åˆ›å»º MethodInvocationï¼Œç®€ç§° mi</li><li>é¦–æ¬¡æ‰§è¡Œ mi.proceed() å‘ç°æœ‰ä¸‹ä¸€ä¸ªç¯ç»•é€šçŸ¥ï¼Œè°ƒç”¨å®ƒçš„ invoke(mi)</li><li>è¿›å…¥ç¯ç»•é€šçŸ¥1ï¼Œæ‰§è¡Œå‰å¢å¼ºï¼Œå†æ¬¡è°ƒç”¨ mi.proceed() å‘ç°æœ‰ä¸‹ä¸€ä¸ªç¯ç»•é€šçŸ¥ï¼Œè°ƒç”¨å®ƒçš„ invoke(mi)</li><li>è¿›å…¥ç¯ç»•é€šçŸ¥2ï¼Œæ‰§è¡Œå‰å¢å¼ºï¼Œè°ƒç”¨ mi.proceed() å‘ç°æ²¡æœ‰ç¯ç»•é€šçŸ¥ï¼Œè°ƒç”¨ mi.invokeJoinPoint() æ‰§è¡Œç›®æ ‡æ–¹æ³•</li><li>ç›®æ ‡æ–¹æ³•æ‰§è¡Œç»“æŸï¼Œå°†ç»“æœè¿”å›ç»™ç¯ç»•é€šçŸ¥2ï¼Œæ‰§è¡Œç¯ç»•é€šçŸ¥2 çš„åå¢å¼º</li><li>ç¯ç»•é€šçŸ¥2ç»§ç»­å°†ç»“æœè¿”å›ç»™ç¯ç»•é€šçŸ¥1ï¼Œæ‰§è¡Œç¯ç»•é€šçŸ¥1 çš„åå¢å¼º</li><li>ç¯ç»•é€šçŸ¥1è¿”å›æœ€ç»ˆçš„ç»“æœ</li></ul><p>å›¾ä¸­ä¸åŒé¢œè‰²å¯¹åº”ä¸€æ¬¡ç¯ç»•é€šçŸ¥æˆ–ç›®æ ‡çš„è°ƒç”¨èµ·å§‹è‡³ç»ˆç»“</p>',28),k=t('<h4 id="æ¼”ç¤º1-é€šçŸ¥è°ƒç”¨è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º1-é€šçŸ¥è°ƒç”¨è¿‡ç¨‹" aria-hidden="true">#</a> æ¼”ç¤º1 - é€šçŸ¥è°ƒç”¨è¿‡ç¨‹</h4><h5 id="ä»£ç å‚è€ƒ-6" tabindex="-1"><a class="header-anchor" href="#ä»£ç å‚è€ƒ-6" aria-hidden="true">#</a> ä»£ç å‚è€ƒ</h5><p><strong>org.springframework.aop.framework.A18</strong></p><h4 id="æ”¶è·ğŸ’¡-13" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-13" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><p>ä»£ç†æ–¹æ³•æ‰§è¡Œæ—¶ä¼šåšå¦‚ä¸‹å·¥ä½œ</p><ol><li>é€šè¿‡ proxyFactory çš„ getInterceptorsAndDynamicInterceptionAdvice() å°†å…¶ä»–é€šçŸ¥ç»Ÿä¸€è½¬æ¢ä¸º MethodInterceptor ç¯ç»•é€šçŸ¥ <ul><li>MethodBeforeAdviceAdapter å°† @Before AspectJMethodBeforeAdvice é€‚é…ä¸º MethodBeforeAdviceInterceptor</li><li>AfterReturningAdviceAdapter å°† @AfterReturning AspectJAfterReturningAdvice é€‚é…ä¸º AfterReturningAdviceInterceptor</li><li>è¿™ä½“ç°çš„æ˜¯é€‚é…å™¨è®¾è®¡æ¨¡å¼</li></ul></li><li>æ‰€è°“é™æ€é€šçŸ¥ï¼Œä½“ç°åœ¨ä¸Šé¢æ–¹æ³•çš„ Interceptors éƒ¨åˆ†ï¼Œè¿™äº›é€šçŸ¥è°ƒç”¨æ—¶æ— éœ€å†æ¬¡æ£€æŸ¥åˆ‡ç‚¹ï¼Œç›´æ¥è°ƒç”¨å³å¯</li><li>ç»“åˆç›®æ ‡ä¸ç¯ç»•é€šçŸ¥é“¾ï¼Œåˆ›å»º MethodInvocation å¯¹è±¡ï¼Œé€šè¿‡å®ƒå®Œæˆæ•´ä¸ªè°ƒç”¨</li></ol><h4 id="æ¼”ç¤º2-æ¨¡æ‹Ÿ-methodinvocation" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º2-æ¨¡æ‹Ÿ-methodinvocation" aria-hidden="true">#</a> æ¼”ç¤º2 - æ¨¡æ‹Ÿ MethodInvocation</h4><h5 id="ä»£ç å‚è€ƒ-7" tabindex="-1"><a class="header-anchor" href="#ä»£ç å‚è€ƒ-7" aria-hidden="true">#</a> ä»£ç å‚è€ƒ</h5><p><strong>org.springframework.aop.framework.A18_1</strong></p><h4 id="æ”¶è·ğŸ’¡-14" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-14" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><ol><li>proceed() æ–¹æ³•è°ƒç”¨é“¾ä¸­ä¸‹ä¸€ä¸ªç¯ç»•é€šçŸ¥</li><li>æ¯ä¸ªç¯ç»•é€šçŸ¥å†…éƒ¨ç»§ç»­è°ƒç”¨ proceed()</li><li>è°ƒç”¨åˆ°æ²¡æœ‰æ›´å¤šé€šçŸ¥äº†, å°±è°ƒç”¨ç›®æ ‡æ–¹æ³•</li></ol><p>MethodInvocation çš„ç¼–ç¨‹æŠ€å·§åœ¨å®ç°æ‹¦æˆªå™¨ã€è¿‡æ»¤å™¨æ—¶èƒ½ç”¨ä¸Š</p><h3 id="_19-åŠ¨æ€é€šçŸ¥è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#_19-åŠ¨æ€é€šçŸ¥è°ƒç”¨" aria-hidden="true">#</a> 19) åŠ¨æ€é€šçŸ¥è°ƒç”¨</h3><h4 id="æ¼”ç¤º-å¸¦å‚æ•°ç»‘å®šçš„é€šçŸ¥æ–¹æ³•è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤º-å¸¦å‚æ•°ç»‘å®šçš„é€šçŸ¥æ–¹æ³•è°ƒç”¨" aria-hidden="true">#</a> æ¼”ç¤º - å¸¦å‚æ•°ç»‘å®šçš„é€šçŸ¥æ–¹æ³•è°ƒç”¨</h4><h5 id="ä»£ç å‚è€ƒ-8" tabindex="-1"><a class="header-anchor" href="#ä»£ç å‚è€ƒ-8" aria-hidden="true">#</a> ä»£ç å‚è€ƒ</h5><p><strong>org.springframework.aop.framework.autoproxy.A19</strong></p><h4 id="æ”¶è·ğŸ’¡-15" tabindex="-1"><a class="header-anchor" href="#æ”¶è·ğŸ’¡-15" aria-hidden="true">#</a> æ”¶è·ğŸ’¡</h4><ol><li>é€šè¿‡ proxyFactory çš„ getInterceptorsAndDynamicInterceptionAdvice() å°†å…¶ä»–é€šçŸ¥ç»Ÿä¸€è½¬æ¢ä¸º MethodInterceptor ç¯ç»•é€šçŸ¥</li><li>æ‰€è°“åŠ¨æ€é€šçŸ¥ï¼Œä½“ç°åœ¨ä¸Šé¢æ–¹æ³•çš„ DynamicInterceptionAdvice éƒ¨åˆ†ï¼Œè¿™äº›é€šçŸ¥è°ƒç”¨æ—¶å› ä¸ºè¦ä¸ºé€šçŸ¥æ–¹æ³•ç»‘å®šå‚æ•°ï¼Œè¿˜éœ€å†æ¬¡åˆ©ç”¨åˆ‡ç‚¹è¡¨è¾¾å¼</li><li>åŠ¨æ€é€šçŸ¥è°ƒç”¨å¤æ‚ç¨‹åº¦é«˜ï¼Œæ€§èƒ½è¾ƒä½</li></ol>',18);function v(m,h){const s=c("Mermaid");return p(),o("div",null,[l,a(s,{id:"mermaid-411",code:"eJxLzkksLnbJTEwvSszl4gLzFBxTyjKTU6Ec39SSjPwUz7yS1KLk1IKS/CIkRcVwXkB+Zl5JcmkJTJQLJqBgU6Orq+BYXJCaXOLlWlFQlFpcnJmfB5PmgtgFUYVpFdQ4iDS6HWh8hXygGqUnOxqU4CrxKIH6kcvGBqgitSgtMTnVzg4miiqI6SxUebhtmGaBnIldMUwWAAImitk="}),u,r,a(s,{id:"mermaid-437",code:"eJxLzkksLnbJTEwvSszl4nJMKcssTk1RsKnR1VUIKMqvqHRLTC7JL6rkQuYo5ANlQxKL0lNLMMWVni6ZpaQANii/iAtVXlfXTsExvwBFzErhyd79z6es4EKXQFaM6rCn83c92dXn7O7j6fR8VgtEARYxBRugWv+krNS81OLMYuf0nMwkmHlAW592zH66exfcVojJ2FWjKfJKyXapzEvMzUyGK4DY7uXijWI3pkIkezE9hKSdiwscL3D/K1RzKSgoaAMDHMzV0AS7NLmEqxamEiXoqrk4C0B8SBw5gxVYKSTl5+ekJuYh9OAIG6DuRKjrrFATAVwnFp/h1WVjk5lXklqUlpicageMVYg6dFHU+MchywUASE8Ciw=="}),d,a(s,{id:"mermaid-731",code:"eJx9kk9OAjEUxvdzii4xiqE1LGTByhg1MWHhBWrnBRqddizVyA10ITFh4ULDwkuYgOE2459b+NrOMMwILCDp937f+15fZwg3t6AEHEneNzyJUm6sFDLlypKe0fejiiIHhA/JqbrTglup1QlX8TWYCpNIx5yDHei4JCvIMRdWm5HjfEZ+rrWhq30sGAEpUrRGsbUUq1AX3PTBRpEPI81ul+ziTTpE4nhX0NiJ8OTVYrAO+Rl/ZIuXwlnoTUc1vXez598w5Hey2NoCV9Yh2cNrNp/hjSI8rlIGhCWmf9lgrdYeYewA/9rtcmjvTuR+arQAiPE6rkGo0PKWiXQF6iuhkD0+Ze/T7HNWi6CHLsdFlPzmCFaPYLnFFdZE0HYRQUNEwW+KCG8QqiHoTEvVw59FKq86cgkuRb/FMMn3fPI1fYtAxfURn8f5iF7PLW4/FUtlcSsW1HNL6ag9oGvgHstL4RtE9Q+9cSxx"}),k])}const g=e(i,[["render",v],["__file","AOP.html.vue"]]);export{g as default};
